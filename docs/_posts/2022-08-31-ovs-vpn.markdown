---
layout: posts
title:  "Open vSwitch(OvS) Usage in Multi-VM Computer"
author: Minjong Ha
published: false
date:   2022-08-31 09:14:00 +0900
---


## Abstract

In this post, I will explain What the OvS is and how can we utilize it on the multi-VM machine.

Suppose that there is a computer that should be connected with seperated, independent network for each VMs.
Host OS can manage the networks with OvS and seperates them logically.
Since the target networks are located in the private network, host should consider the VPN handling from VMs.


## Introduction

### Open vSwitch (OvS)

Open vSwitch implements virtual, software based switch instead of physical switch.
OvS can support multiple virtual NICs(vNIC) with single physical NIC cable

<!---OvS example image --->

Above image represents the overall architecture of OvS applied system.
There are two VMs with different purposes (internal / external), and OvS supports them by providing virtual NICs.

### Target Design

The goal is implementing logically seperated multi-VM environment.
For example, suppose there are two VMs: one for private network (intranet), and another for public network (internet).
Many enterprises and organizations deploy their private network for privacy.
They manage their sensitive informations which not supposed to be leak.
However, they also need to connect to the internet to use e-mail and etc.
In this case, their network are usually having following shape.

<!---VPN Environment image--->

It is reasonable network topology if their computers are located in private network.
However, since the increase of the remote work, it is required that accessing to the private network from the public network.
 
Each VMs should looks like located in the private network.

Fortunately, libvirt supports ovs network bridge for KVM.

```
<network>
  <name>test</name>
  <forward mode='bridge'/>
  <bridge name='internal-br'/>
  <virtualport type='openvswitch'/>
  <portgroup name='vlan-01' default='yes'>
  </portgroup>
</network>
```

Following xml represents the libvirt network supporting ovs bridge.
Unlike the original network xml has information about the network itself, ovs network xml only contains the name of bridge and virtual port type.
Since it only indicates the name of ovs bridge, the policy about the network name is required.
If the ovs-bridge were created and activated, network packets coming from the VM go to it through the VM tap.


